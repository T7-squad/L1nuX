
- The Linux System normally uses the *DAC (Directory Access Control)*, which says, that the owner of a file decides who can access the file.
- The *SELinux* is a security Mode in Linux, which enable the MAC (Mandatory Access Control). Here is an Example of MAC :
  ![[Pasted image 20240326160200.png]]

# Installation

- To install SELinux, enter the tools :
  
```bash
  sudo apt install policycoreutils selinux-basics selinux-utils -y
```

- To enable SELinux :
  
```bash
  sudo selinux-activate
```

![[Pasted image 20240326163302.png]]

After restarting your system, you will get something like this :
![[Pasted image 20240326163427.png]]

- To see the status of the SELinux, enter the command : `sestatus` :
  ![[Pasted image 20240326163733.png]]


# SELinux Contexts Permissions

- SELinux controls the access of an *object* (file, application ...) from a *Subject* (application or a user) .
- To list the files and directories by there permissions use the command `ls -Z`:
  ![[Pasted image 20240326164055.png]]
  
  - `_u` : represent the user.
  - `_r` : role.
  - `_t` : type.
  - `_s0` : Security level (Default is s0, means that the data is unclassified ).

Here are some user permissions :
![[Pasted image 20240326175301.png]]


- To change the context of a file we use the command `chcon`.
  - Lets say, we want to change the content *type* of the `adir` directory from `admin_home_t` to `unconfined_t` we use the command :
    
	```bash
    chcon -R -r unconfined_r -t unconfined_t ./adir
	```
	
	![[Pasted image 20240326183804.png]]

- More about `chcon` :
  ![[Pasted image 20240326184005.png]]

- To get more informations about the attributes of SELinux, use the command `seinfo`.
  - `seinfo -t` : will display informations about the types.
  - `seinfo -r` : will display the informations about the role ...
# Enabling SELinux

- SELinux have 3 Modes :
  
  - *Enforcing or 1* : denies access to users based on the SELinux policies.
  - *Permissive or 0* : record logs of actions and don't block the users.
  - *Disabled* : dis-activate SELinux.

- To change the mode, use the `getenforce >Mode<` command :
  ![[Pasted image 20240326180300.png]]
- This modes are present in the `/etc/selinux/config` file :
  ![[Pasted image 20240326180433.png]]


> [!Important]
> 
> - The only way to *Disable* SELinux, is by changing the `SELINUX=disabled` in the `/etc/selinux/default` !


- You can use the `semanage` to :
  
  - *Manage Rules* : Enable/Disable, Remove rules :
    
![[Pasted image 20240425151337.png]]
    
  - *Managing Users* : Add/Remove, modify Users :
    
```bash
    semanage <user> -d <myuser>     ### delete a user
    semanage <user> -l              ### list users/roles
    
```

    
# Using SELinux Booleans


- There are about 300 booleans. to list them use the command :
  
```
seemanage boolean -l 
```

Or the command `getsebool -a`.

![[Pasted image 20240326194501.png]]

- To display the state of a particular boolean use the command `getsetbool`, we take the :
  
```
  getsebool cron_can_relabel
```

- To set the a boolean to a value (`on/off`), use the command `setsebool` :
  
```
  setsebool cron_can_relabel on
```


> [!Important]
> - The settings are lost when rebooting the system. to make them permanent, use the command :
>   
> ```
>   setsebool -P
> ```


# Auditing SELinux

- *Auditing* is made to store all the informations and messages generated by the SELinux in a particular file called *audit*, and its located in :
  
```
  /var/log/audit/audit.log
```

- Firs you need to install `setroubleshoot-server` on your system (works well on Fedora systems).

## Listing messages

- To list the SELinux notification and messages, use the command :
  
```
  sealert -a /var/log/audit/audit.log
```

